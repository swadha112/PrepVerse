services:
  server:
    image: node:20-alpine
    container_name: pv-server
    working_dir: /app
    command: sh -c "npm ci || npm i && npm start"
    volumes:
      - ./server:/app
      - /app/node_modules
      # mount your Firebase SA where your server expects it
      - ./server/firebase-service-account.json:/app/firebase-service-account.json:ro
    ports:
      - "4000:4000"
    env_file:
      - ./server/.env
    environment:
      # ensure the server sees the credentials path inside the container
      GOOGLE_APPLICATION_CREDENTIALS: ./firebase-service-account.json
      NODE_ENV: development

  client:
    image: node:20-alpine
    container_name: pv-client
    working_dir: /app
    command: sh -c "npm ci || npm i && npm run dev -- --host 0.0.0.0 --port 5173"
    volumes:
      - ./client:/app
      - /app/node_modules
    ports:
      - "5173:5173"
    env_file:
      - ./client/.env
    depends_on:
      - server